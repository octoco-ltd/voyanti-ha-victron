number:
  - unique_id: min_soc_limit
    name: Minimum SOC Limit
    min: 20
    max: 100
    step: 5
    mode: slider
    command_topic: "victron-home/W/c0847d9b49b3/settings/0/Settings/CGwacs/BatteryLife/MinimumSocLimit"
    command_template: '{"value": {{ value }} }'
    state_topic: "victron-home/N/c0847d9b49b3/settings/0/Settings/CGwacs/BatteryLife/MinimumSocLimit"
    value_template: "{{ value_json.value | round(0) }}"
    device_class: battery
    icon: mdi:battery-heart-outline
    unit_of_measurement: '%'
    device: &cerbo_device
      identifiers:
        - "Victron Cerbo GX"
      manufacturer: "Victron Energy"
      model: "Cerbo GX"
      name: "Cerbo GX"

sensor:
  - state_topic: "victron-home/N/c0847d9b49b3/grid/30/Ac/Energy/Forward"
    name: "Grid energy meter import"
    device_class: energy
    state_class: total_increasing
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    unit_of_measurement: "kWh"
    unique_id: "grid_meter_import"
    device: &grid_meter_device
      identifiers:
        - "Victron Grid Meter"
      manufacturer: "Victron Energy"
      model: "ET340"
      name: "Victron Grid Meter"

  - state_topic: "victron-home/N/c0847d9b49b3/grid/30/Ac/Energy/Reverse"
    name: "Grid energy meter export"
    device_class: energy
    state_class: total_increasing
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    unit_of_measurement: "kWh"
    unique_id: "grid_meter_export"
    device: *grid_meter_device

  - state_topic: "victron-home/N/c0847d9b49b3/system/0/Dc/Battery/Soc"
    name: "Battery Percent"
    unique_id: "victron_battery_soc"
    device_class: battery
    unit_of_measurement: "%"
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    device: *cerbo_device

  - state_topic: victron-home/N/c0847d9b49b3/settings/0/Settings/CGwacs/BatteryLife/SocLimit
    name: Active SOC Limit
    device_class: battery
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    unit_of_measurement: '%'
    unique_id: active_soc_limit 
    device: *cerbo_device

  - state_topic: victron-home/N/c0847d9b49b3/system/0/Dc/Battery/Voltage
    name: Battery Voltage
    unique_id: victron_battery_voltage
    device_class: voltage
    value_template: '{{ value_json.value|float(0)|round(2) }}'
    unit_of_measurement: V
    device: *cerbo_device 

  - state_topic: victron-home/N/c0847d9b49b3/system/0/Dc/Battery/Power
    name: Battery Load
    unique_id: victron_battery_load
    device_class: power
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    unit_of_measurement: W
    device: *cerbo_device 
  
  - state_topic: victron-home/N/c0847d9b49b3/system/0/Ac/Consumption/L1/Power
    name: AC Loads - Phase 1
    device_class: power
    value_template: '{{ value_json.value|round(0)}}'
    unit_of_measurement: W
    icon: 'mdi:power-socket-uk'
    unique_id: victron_acload_l1
    device: *cerbo_device 

  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Ac/Out/L1/V
    name: AC Output Voltage - Phase 1
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: Victron_AC_Output_Voltage_L1
    device: &inverter_device
      identifiers:
        - "Victron Quattro 48/10000"
      manufacturer: "Victron Energy"
      model: "Quattro 48/10000"
      name: "Victron Inverter" 

  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Ac/Out/L1/I
    name: AC Output Current - Phase 1
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: Victron_AC_Output_Current_L1
    device: *inverter_device 
  
  - state_topic: victron-home/N/c0847d9b49b3/system/0/Ac/Consumption/L2/Power
    name: AC Loads - Phase 2
    device_class: power
    value_template: '{{ value_json.value | round(0) }}'
    unit_of_measurement: W
    icon: 'mdi:power-socket-uk'
    unique_id: victron_acload_l2
    device: *inverter_device 

  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Ac/Out/L2/V
    name: AC Output Voltage - Phase 2
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: Victron_AC_Output_Voltage_L2
    device: *inverter_device 

  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Ac/Out/L2/I
    name: AC Output Current - Phase 2
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: Victron_AC_Output_Current_L2
    device: *inverter_device 

  - state_topic: victron-home/N/c0847d9b49b3/system/0/Ac/Consumption/L3/Power
    name: AC Loads - Phase 3
    device_class: power
    value_template: '{{ value_json.value | round(0) }}'
    unit_of_measurement: W
    icon: 'mdi:power-socket-uk'
    unique_id: victron_acload_l3
    device: *cerbo_device 
  
  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Ac/Out/L3/V
    name: AC Output Voltage - Phase 3
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: Victron_AC_Output_Voltage_L3
    device: *inverter_device 

  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Ac/Out/L3/I
    name: AC Output Current - Phase 3
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: Victron_AC_Output_Current_L3
    device: *inverter_device

  - state_topic: victron-home/N/c0847d9b49b3/system/0/Ac/Grid/L1/Power
    name: Grid Power - Phase 1
    device_class: power
    value_template: |-
      {% if value_json is defined and value_json.value is not none %}
        {{ value_json.value | round(0) }}
      {% else %}
        0
      {% endif %}
    unit_of_measurement: W
    icon: 'mdi:power-socket-uk'
    unique_id: Victron_Grid_L1
    device: *cerbo_device 
  
  - state_topic: victron-home/N/c0847d9b49b3/system/0/Ac/Grid/L2/Power
    name: Grid Power - Phase 2
    device_class: power
    value_template: |-
      {% if value_json is defined and value_json.value is not none %}
        {{ value_json.value | round(0) }}
      {% else %}
        0
      {% endif %}
    unit_of_measurement: W
    icon: 'mdi:power-socket-uk'
    unique_id: Victron_Grid_L2
    device: *cerbo_device 
  
  - state_topic: victron-home/N/c0847d9b49b3/system/0/Ac/Grid/L3/Power
    name: Grid Power - Phase 3
    device_class: power
    value_template: |-
      {% if value_json is defined and value_json.value is not none %}
        {{ value_json.value | round(0) }}
      {% else %}
        0
      {% endif %}
    unit_of_measurement: W
    icon: 'mdi:power-socket-uk'
    unique_id: Victron_Grid_L3
    device: *cerbo_device 
  
  - state_topic: victron-home/N/c0847d9b49b3/grid/30/Ac/Power
    name: Grid Power Total
    device_class: power
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: W
    icon: 'mdi:power-socket-uk'
    unique_id: Victron_Grid_Power_Tot
    device: *grid_meter_device 

  - state_topic: victron-home/N/c0847d9b49b3/grid/30/Ac/L1/Voltage
    name: Grid Voltage - Phase 1
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: Victron_Grid_Voltage_L1
    device: *grid_meter_device

  - state_topic: victron-home/N/c0847d9b49b3/grid/30/Ac/L2/Voltage
    name: Grid Voltage - Phase 2
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: Victron_Grid_Voltage_L2
    device: *grid_meter_device 

  - state_topic: victron-home/N/c0847d9b49b3/grid/30/Ac/L3/Voltage
    name: Grid Voltage - Phase 3
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: Victron_Grid_Voltage_L3
    device: *grid_meter_device 

  - state_topic: victron-home/N/c0847d9b49b3/grid/30/Ac/L1/Current
    name: Grid Current - Phase 1
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: Victron_Grid_Curent_L1
    device: *grid_meter_device 

  - state_topic: victron-home/N/c0847d9b49b3/grid/30/Ac/L2/Current
    name: Grid Current - Phase 2
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: Victron_Grid_Curent_L2
    device: *grid_meter_device 

  - state_topic: victron-home/N/c0847d9b49b3/grid/30/Ac/L3/Current
    name: Grid Current - Phase 3
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: Victron_Grid_Curent_L3
    device: *grid_meter_device 

  - state_topic: victron-home/N/c0847d9b49b3/system/0/Dc/Pv/Power
    name: Current Solar Production
    device_class: power
    state_class: measurement
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    unit_of_measurement: W
    icon: 'mdi:solar-power'
    unique_id: Current_SolarPower
    device: *cerbo_device 

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/0/Yield/Power
    name: MPPT 0 Production
    device_class: power
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    unit_of_measurement: W
    icon: 'mdi:solar-power'
    unique_id: mppt_0_power
    device: &mppt_device0
      identifiers:
        - "Victron MPPT 0"
      manufacturer: "Victron Energy"
      model: "MPPT 250-100"
      name: "Victron MPPT 1"

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/0/Dc/0/Voltage
    name: MPPT 0 Voltage
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: mppt_0_voltage  
    device: *mppt_device0 

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/0/Dc/0/Current
    name: MPPT 0 Current
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: mppt_0_current
    device: *mppt_device0 

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/277/Yield/Power
    name: MPPT 277 Production
    device_class: power
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    unit_of_measurement: W
    icon: 'mdi:solar-power'
    unique_id: mppt_277_power
    device: &mppt_device277
      identifiers:
        - "Victron MPPT 270"
      manufacturer: "Victron Energy"
      model: "MPPT 250-100"
      name: "Victron MPPT 2"

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/277/Dc/0/Voltage
    name: MPPT 277 Voltage
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: mppt_277_voltage  
    device: *mppt_device277 

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/277/Dc/0/Current
    name: MPPT 277 Current
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: mppt_277_current
    device: *mppt_device277 

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/280/Yield/Power
    name: MPPT 280 Production
    device_class: power
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    unit_of_measurement: W
    icon: 'mdi:solar-power'
    unique_id: mppt_280_power
    device: &mppt_device280
      identifiers:
        - "Victron MPPT 280"
      manufacturer: "Victron Energy"
      model: "MPPT 250-100"
      name: "Victron MPPT 3"

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/280/Dc/0/Voltage
    name: MPPT 280 Voltage
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: mppt_280_voltage
    device: *mppt_device280

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/280/Dc/0/Current
    name: MPPT 280 Current
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: mppt_280_current
    device: *mppt_device280

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/281/Yield/Power
    name: MPPT 281 Production
    device_class: power
    value_template: '{{ value_json.value|float(0)|round(0) }}'
    unit_of_measurement: W
    icon: 'mdi:solar-power'
    unique_id: mppt_281_power
    device: &mppt_device281
      identifiers:
        - "Victron MPPT 281"
      manufacturer: "Victron Energy"
      model: "MPPT 250-60"
      name: "Victron MPPT 4"

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/281/Dc/0/Voltage
    name: MPPT 281 Voltage
    device_class: voltage
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: V
    unique_id: mppt_281_voltage
    device: *mppt_device281

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/281/Dc/0/Current
    name: MPPT 281 Current
    device_class: current
    value_template: "{{ (value_json.value | float(default=0) | round(1)) if value_json is defined and value_json.value is not none else 0 }}"
    unit_of_measurement: A
    unique_id: mppt_281_current
    device: *mppt_device281

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/277/State
    name: Solar Charger State 277
    value_template: >
      {% if value_json is defined and value_json.value is defined %}
        {% if value_json.value == 0 %}
          Off
        {% elif value_json.value == 2 %}
          Fault
        {% elif value_json.value == 3 %}
          Bulk
        {% elif value_json.value == 4 %}
          Absorption
        {% elif value_json.value == 5 %}
          Float
        {% elif value_json.value == 6 %}
          Storage
        {% elif value_json.value == 7 %}
          Equalize
        {% elif value_json.value == 11 %}
          Other (Hub-1)
        {% elif value_json.value == 252 %}
          External control
        {% else %}
          Error - No Data
        {% endif %}
      {% else %}
        Waiting for Data
      {% endif %}
    unique_id: Victron_MPPT_State_277
    device: *mppt_device277  

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/280/State
    name: Solar Charger State 280
    value_template: >
      {% if value_json is defined and value_json.value is defined %}
        {% if value_json.value == 0 %}
          Off
        {% elif value_json.value == 252 %}
          External control
        {% elif value_json.value == 2 %}
          Fault
        {% elif value_json.value == 3 %}
          Bulk
        {% elif value_json.value == 4 %}
          Absorption
        {% elif value_json.value == 5 %}
          Float
        {% elif value_json.value == 6 %}
          Storage
        {% elif value_json.value == 7 %}
          Equalize
        {% elif value_json.value == 11 %}
          Other (Hub-1)
        {% else %}
          Error - No Data
        {% endif %}
      {% else %}
        Waiting for Data
      {% endif %}     
    unique_id: Victron_MPPT_State_280
    device: *mppt_device280

  - state_topic: victron-home/N/c0847d9b49b3/solarcharger/281/State
    name: Solar Charger State 281
    value_template: >
      {% if value_json is defined and value_json.value is defined %}
        {% if value_json.value == 0 %}
          Off
        {% elif value_json.value == 2 %}
          Fault
        {% elif value_json.value == 3 %}
          Bulk
        {% elif value_json.value == 4 %}
          Absorption
        {% elif value_json.value == 5 %}
          Float
        {% elif value_json.value == 6 %}
          Storage
        {% elif value_json.value == 7 %}
          Equalize
        {% elif value_json.value == 11 %}
          Other (Hub-1)
        {% elif value_json.value == 252 %}
          External control
        {% else %}
          Error - No Data
        {% endif %}
      {% else %}
        Waiting for Data
      {% endif %}     
    unique_id: Victron_MPPT_State_281
    device: *mppt_device281

  - state_topic: victron-home/N/c0847d9b49b3/system/0/Ac/ActiveIn/Source
    name: Active input source
    unique_id: active_input
    value_template: >
      {% if value_json is defined and value_json.value is defined %}
        {% if value_json.value == 0 %}
          Unknown
        {% elif value_json.value == 1 %}
          Connected
        {% elif value_json.value == 2 %}
          Generator
        {% elif value_json.value == 3 %}
          Shore power
        {% elif value_json.value == 240 %}
          Disconnected
        {% else %}
          Error - No Data
        {% endif %}
      {% else %}
        Waiting for Data
      {% endif %}
    device: *cerbo_device 

  - state_topic: victron-home/N/c0847d9b49b3/system/0/SystemState/State
    name: Inverter State
    value_template: >
      {% if value_json is defined and value_json.value is defined %}
        {% if value_json.value == 0 %}
          Off
        {% elif value_json.value == 252 %}
          External control
        {% elif value_json.value == 1 %}
          Low Power
        {% elif value_json.value == 2 %}
          Fault
        {% elif value_json.value == 3 %}
          Bulk
        {% elif value_json.value == 4 %}
          Absorption
        {% elif value_json.value == 5 %}
          Float
        {% elif value_json.value == 6 %}
          Storage
        {% elif value_json.value == 7 %}
          Equalize
        {% elif value_json.value == 8 %}
          Passthru
        {% elif value_json.value == 9 %}
          Inverting
        {% elif value_json.value == 10 %}
          Power assist
        {% elif value_json.value == 11 %}
          Power supply mode
        {% else %}
          Error - No Data
        {% endif %}
      {% else %}
        Waiting for Data
      {% endif %}
    unique_id: Victron_Quattro_State
    device: *cerbo_device   

binary_sensor:
  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Alarms/PhaseRotation
    name: Phase Rotation Alarm
    payload_on: "1"
    payload_off: "0"
    device_class: problem
    value_template: '{{ value_json.value }}'
    unique_id: phase_rotation_alarm
    device: *inverter_device

  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Alarms/LowBattery
    name: Low Battery Alarm
    payload_on: "1"
    payload_off: "0"
    device_class: battery
    value_template: '{{ value_json.value }}'
    unique_id: low_battery_alarm
    device: *inverter_device
 
  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Alarms/Overload
    name: Overload Alarm
    payload_on: "1"
    payload_off: "0"
    device_class: problem
    value_template: '{{ value_json.value }}'
    unique_id: overload_alarm
    device: *inverter_device
 
  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Alarms/Ripple
    name: Ripple Alarm
    payload_on: "1"
    payload_off: "0"
    device_class: problem
    value_template: '{{ value_json.value }}'
    unique_id: ripple_alarm
    device: *inverter_device
 
  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Alarms/TemperatureSensor
    name: Temperature Sensor Alarm
    payload_on: "1"
    payload_off: "0"
    device_class: heat
    value_template: '{{ value_json.value }}'
    unique_id: temperature_sensor_alarm
    device: *inverter_device
 
  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Alarms/VoltageSensor
    name: Voltage Sensor Alarm
    payload_on: "1"
    payload_off: "0"
    device_class: problem
    value_template: '{{ value_json.value }}'
    unique_id: voltage_sensor_alarm
    device: *inverter_device
 
  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Alarms/HighDcCurrent
    name: High DC Current Alarm
    payload_on: "1"
    payload_off: "0"
    device_class: problem
    value_template: '{{ value_json.value }}'
    unique_id: high_dc_current_alarm
    device: *inverter_device 
 
  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Alarms/HighDcVoltage
    name: High DC Voltage Alarm
    payload_on: "1"
    payload_off: "0"
    device_class: problem
    value_template: '{{ value_json.value }}'
    unique_id: high_dc_voltage_alarm
    device: *inverter_device 
 
  - state_topic: victron-home/N/c0847d9b49b3/vebus/276/Alarms/HighTemperature
    name: High Temperature Alarm
    payload_on: "1"
    payload_off: "0"
    device_class: heat
    value_template: '{{ value_json.value }}'
    unique_id: high_temperature_alarm
    device: *inverter_device